/*!
 Porcelain
 * Version: 0.1.0 
 * Built: 2014-05-21 
 */
function Util(){}function BaseChart(){this._addCommas=function(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}}var Porcelain=function(){this._chart_selector=".porcelain-chartable",this._chart_types={},this._charts=[],this.init()};Porcelain.prototype.init=function(){this.constructDOMCharts()},Porcelain.prototype.addChart=function(a,b,c){return this._charts.push({chart:a,node:b,type:c}),this._charts.length},Porcelain.prototype.addChartToRegistry=function(a,b){if(!Util.searchPrototypeChain(b.prototype,BaseChart.prototype))throw"Chart: '"+a+"' must inherit from BaseChart";if(!b.prototype.hasOwnProperty("render"))throw"Chart: '"+a+"' must implement a 'render' method";if(this._chart_types[a])throw"Chart '"+a+"' already defined. Skipping ...";var c;this.overrideRenderer(b),this._chart_types[a]=b,Object.defineProperty(this,a,{get:function(){return function(d){return c=new b(d),this.addChart(c,d,a),c}}})},Porcelain.prototype.assignChartProperties=function(a,b){var c,d;if(a.getAttribute("data-capabilities")){d=JSON.parse(a.getAttribute("data-capabilities"));for(var e in d)b.capabilities[e]&&(b[e]=d[e])}for(var e in b.capabilities)c=a.getAttribute("data-"+e.replace("_","-")),c&&(b[e]=Util.parseAttribute(c,b,e))},Porcelain.prototype.constructDOMCharts=function(){for(var a,b,c,d=document.querySelectorAll(this._chart_selector),e=0;e<d.length;e++){a=d[e],b=a.getAttribute("data-chart-type");try{c=this[Util.titleCase(b)](a)}catch(f){return void console.warn('Chart type: "'+b+'" not found. Skipping render')}this.assignChartProperties(a,c),c.render()}},Porcelain.prototype.overrideRenderer=function(a){var b=a.prototype.render;Object.defineProperties(a.prototype,{render:{value:function(){a.prototype.hasOwnProperty("beforeRender")&&a.prototype.beforeRender.call(this),this.validate(arguments,function(){b.apply(this,arguments),a.prototype.hasOwnProperty("afterRender")&&a.prototype.afterRender.call(this)})}}})},Porcelain.prototype.register=function(a,b){try{this.addChartToRegistry(a,b)}catch(c){console.warn(c)}},Object.defineProperties(Porcelain.prototype,{charts:{get:function(){return this._charts}},types:{get:function(){return this._chart_types}}}),window.Porcelain=new Porcelain,document.addEventListener("DOMContentLoaded",function(){Porcelain.init()}),Util.prototype.parseAttribute=function(a,b,c){var d=b.capabilities[c].type;return Util.formatType(a,d)},Util.prototype.formatType=function(a,b){switch(b){case"boolean":return"true"==a?!0:!1;case"int":return parseInt(a);case"float":return parseFloat(a);default:return a}},Util.prototype.extend=function(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a},Util.prototype.extendChart=function(a,b){a.prototype=Object.create(b.prototype),Object.defineProperties(a.prototype,{constructor:{value:a},_capabilities:{value:function(){return Util.extend({},b.prototype.capabilities)}()}})},Util.prototype.searchPrototypeChain=function(a,b){for(;"object"==typeof a&&a!=Object.prototype;)if(a=Object.getPrototypeOf(a),a==b)return!0;return!1},Util.prototype.randomColor=function(){return"#"+Math.floor(16777216*Math.random()).toString(16)},Util.prototype.titleCase=function(a){var b=a.split("-"),c="";return b.forEach(function(a){c+=a.substr(0,1).toUpperCase(),c+=a.substr(1)}),c},Util=new Util,Object.defineProperties(BaseChart.prototype,{validate:{value:function(a,b){var c=this,d=!0;Object.keys(this.capabilities).forEach(function(a){c.capabilities[a].required&&(c[a]||(d=!1,console.warn('Required capability "'+a+'" not set, skipping render')))}),d&&b.apply(this,a)}},_capabilities:{writable:!0,value:{}},capabilities:{get:function(){return this._capabilities}},chart:{get:function(){return this._chart},set:function(a){this._chart=a},enumerable:!1},defineCapability:{value:function(a,b){var c=b.descriptor.defined_in.prototype;c._capabilities[a]=b.descriptor,Object.defineProperty(c,"_"+a,{writable:!0,enumerable:!1,value:b.descriptor.default}),Object.defineProperty(c,a,b.property)}}}),BaseChart.prototype.defineCapability("data",{property:{get:function(){return this._data},set:function(a){this._data="string"==typeof a?JSON.parse(a):a},enumerable:!0},descriptor:{defined_in:BaseChart,description:"Data passed into the chart",required:!0,type:"JSON"}}),BaseChart.prototype.defineCapability("element",{property:{get:function(){return this._element},set:function(a){this._element="string"==typeof a?document.querySelectorAll(a)[0]:a},enumerable:!0},descriptor:{defined_in:BaseChart,description:"Element into which to draw the chart. The element passed is either a selector string or a DOM element reference",required:!0,type:"string|element"}}),BaseChart.prototype.defineCapability("margins",{property:{get:function(){return this._margins},set:function(a){this._margins=a},enumerable:!0},descriptor:{defined_in:BaseChart,description:'Sets the margins between the chart and the containing dom element. Accepts a object with "top", "right", "bottom" and "left" properties.',"default":{top:30,right:30,bottom:30,left:30},required:!0,type:"JSON"}}),BaseChart.prototype.defineCapability("size",{property:{get:function(){return this._size},set:function(a){this._size="auto"==a?{width:_el.offsetWidth,height:_el.offsetHeight}:a},enumerable:!0},descriptor:{defined_in:BaseChart,description:'Sets the width and height of the chart. Accepts a object with "width" and "height" properties or a string "auto", which sets dimensions to that of the prentent element.',"default":{width:400,height:400},required:!0,type:"JSON"}}),BaseChart.prototype.defineCapability("theme",{property:{get:function(){return this._theme},set:function(a){this._theme={domain:[],range:[],name:a};for(var b in a)this._theme.domain.push(b),this._theme.range.push(a[b])},enumerable:!0},descriptor:{defined_in:BaseChart,description:"Color-set for charted data.","default":{domain:[],range:[Util.randomColor(),Util.randomColor(),Util.randomColor(),Util.randomColor()],name:{}},required:!1,type:"JSON"}});